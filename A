import javax.swing.*;
import java.util.LinkedList;
import java.util.Queue;

public class SistemaVentas {
    private Queue<Articulo> cola = new LinkedList<>();

    public void iniciar() {
        while (true) {
            String opcion = JOptionPane.showInputDialog("""
                    1. Ingresar artículo
                    2. Vender artículo
                    3. Modificar artículo
                    4. Eliminar artículo
                    5. Mostrar artículos
                    6. Salir""");

            if (opcion == null) break;

            switch (opcion) {
                case "1" -> ingresarArticulo();
                case "2" -> venderArticulo();
                case "3" -> modificarArticulo();
                case "4" -> eliminarArticulo();
                case "5" -> mostrarArticulos();
                case "6" -> System.exit(0);
                default -> JOptionPane.showMessageDialog(null, "Opción no válida.");
            }
        }
    }

    private void ingresarArticulo() {
        try {
            String nombre = JOptionPane.showInputDialog("Nombre del artículo:");
            if (nombre == null || nombre.trim().isEmpty())
                throw new Exception("Nombre inválido");

            double precio = pedirDouble("Precio:");
            int cantidad = pedirEntero("Cantidad:");

            cola.add(new Articulo(nombre.trim(), precio, cantidad));
            JOptionPane.showMessageDialog(null, "Artículo agregado correctamente.");
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Error al ingresar artículo: " + e.getMessage());
        }
    }

    private void venderArticulo() {
        if (cola.isEmpty()) {
            JOptionPane.showMessageDialog(null, "No hay artículos para vender.");
            return;
        }

        try {
            double ventaPromedio = pedirDouble("Ingrese la venta promedio:");

            mostrarArticulos();

            String nombreArt = JOptionPane.showInputDialog("Nombre del artículo a vender:");
            if (nombreArt == null || nombreArt.trim().isEmpty())
                throw new Exception("Nombre inválido");

            boolean encontrado = false;
            for (Articulo art : cola) {
                if (art.getNombre().equalsIgnoreCase(nombreArt.trim())) {
                    String nombreCliente = JOptionPane.showInputDialog("Nombre del cliente:");
                    if (nombreCliente == null || nombreCliente.trim().isEmpty())
                        throw new Exception("Nombre del cliente inválido");

                    String cedula = JOptionPane.showInputDialog("Cédula del cliente:");
                    if (cedula == null || cedula.trim().isEmpty())
                        throw new Exception("Cédula inválida");

                    double precioFinal = art.getPrecio();
                    if (precioFinal > ventaPromedio) {
                        precioFinal *= 0.9;
                    }

                    JOptionPane.showMessageDialog(null,
                            "Venta realizada\nCliente: " + nombreCliente +
                            "\nCédula: " + cedula +
                            "\nArtículo: " + art.getNombre() +
                            "\nPrecio final: $" + precioFinal);
                    encontrado = true;
                    break;
                }
            }

            if (!encontrado) {
                JOptionPane.showMessageDialog(null, "Artículo no encontrado.");
            }

        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Error: " + e.getMessage());
        }
    }

    private void modificarArticulo() {
        if (cola.isEmpty()) {
            JOptionPane.showMessageDialog(null, "No hay artículos para modificar.");
            return;
        }

        try {
            double ventaPromedio = pedirDouble("Ingrese la venta promedio:");

            mostrarArticulos();

            String nombre = JOptionPane.showInputDialog("Nombre del artículo a modificar:");
            if (nombre == null || nombre.trim().isEmpty())
                throw new Exception("Nombre inválido");

            boolean modificado = false;
            for (Articulo art : cola) {
                if (art.getNombre().equalsIgnoreCase(nombre.trim())) {
                    double nuevoPrecio = pedirDouble("Nuevo precio:");

                    if (nuevoPrecio > ventaPromedio) {
                        nuevoPrecio *= 0.9;
                    }

                    int nuevaCantidad = pedirEntero("Nueva cantidad:");

                    art.setPrecio(nuevoPrecio);
                    art.setCantidad(nuevaCantidad);

                    JOptionPane.showMessageDialog(null, "Artículo modificado.");
                    modificado = true;
                    break;
                }
            }

            if (!modificado) {
                JOptionPane.showMessageDialog(null, "Artículo no encontrado.");
            }

        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Error: " + e.getMessage());
        }
    }

    private void eliminarArticulo() {
        if (cola.isEmpty()) {
            JOptionPane.showMessageDialog(null, "No hay artículos para eliminar.");
            return;
        }

        mostrarArticulos();

        String nombre = JOptionPane.showInputDialog("Nombre del artículo a eliminar:");
        if (nombre == null || nombre.trim().isEmpty()) {
            JOptionPane.showMessageDialog(null, "Nombre inválido");
            return;
        }

        boolean eliminado = false;
        int tamaño = cola.size();
        for (int i = 0; i < tamaño; i++) {
            Articulo actual = cola.poll();
            if (actual.getNombre().equalsIgnoreCase(nombre.trim())) {
                eliminado = true;
                JOptionPane.showMessageDialog(null, "Artículo eliminado correctamente.");
            } else {
                cola.add(actual);
            }
        }

        if (!eliminado) {
            JOptionPane.showMessageDialog(null, "Artículo no encontrado.");
        }
    }

    private void mostrarArticulos() {
        if (cola.isEmpty()) {
            JOptionPane.showMessageDialog(null, "No hay artículos en el inventario.");
            return;
        }

        StringBuilder sb = new StringBuilder("Artículos en inventario:\n");
        for (Articulo art : cola) {
            sb.append(art.toString()).append("\n");
        }
        JOptionPane.showMessageDialog(null, sb.toString());
    }

    // Métodos auxiliares para validación
    private double pedirDouble(String mensaje) {
        while (true) {
            try {
                String input = JOptionPane.showInputDialog(mensaje);
                if (input == null) throw new Exception("Operación cancelada");
                double valor = Double.parseDouble(input);
                if (valor <= 0) throw new NumberFormatException();
                return valor;
            } catch (NumberFormatException e) {
                JOptionPane.showMessageDialog(null, "Ingrese un número válido mayor a 0.");
            }
        }
    }

    private int pedirEntero(String mensaje) {
        while (true) {
            try {
                String input = JOptionPane.showInputDialog(mensaje);
                if (input == null) throw new Exception("Operación cancelada");
                int valor = Integer.parseInt(input);
                if (valor <= 0) throw new NumberFormatException();
                return valor;
            } catch (NumberFormatException e) {
                JOptionPane.showMessageDialog(null, "Ingrese un número entero válido mayor a 0.");
            }
        }
    }
}
